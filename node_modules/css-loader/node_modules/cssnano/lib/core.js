'use strict';

var postcss = require('postcss');

function minimiseWhitespace (rule) {
<<<<<<< HEAD
    rule.raws.before = rule.raws.between = rule.raws.after = '';
    rule.raws.semicolon = false;
=======
    rule.before = rule.between = rule.after = '';
    rule.semicolon = false;
>>>>>>> 14e45b6ab8a1ca954f5516d80087167e98f6b292
}

module.exports = postcss.plugin('cssnano-core', function () {
    return function (css) {
<<<<<<< HEAD
        css.walkDecls(function (declaration) {
            // Ensure that !important values do not have any excess whitespace
            if (declaration.important) {
                declaration.raws.important = '!important';
=======
        css.eachDecl(function (declaration) {
            // Ensure that !important values do not have any excess whitespace
            if (declaration.important) {
                declaration._important = '!important';
>>>>>>> 14e45b6ab8a1ca954f5516d80087167e98f6b292
            }
            // Trim unnecessary space around e.g. 12px / 18px
            declaration.value = declaration.value.replace(/\s*(\/)\s*/, '$1');
            if (~[
                    'outline',
                    'outline-left',
                    'outline-right',
                    'outline-top',
                    'outline-bottom'
                ].indexOf(declaration.prop)) {
                declaration.value = declaration.value.replace('none', '0');
            }
            // Remove whitespaces around ie 9 hack
            declaration.value = declaration.value.replace(/\s*(\\9)\s*/, '$1');
            // Remove extra semicolons and whitespace before the declaration
<<<<<<< HEAD
            if (declaration.raws.before) {
                declaration.raws.before = declaration.raws.before.replace(/[;\s]/g, '');
            }
            declaration.raws.between = ':';
            declaration.raws.semicolon = false;
        });

        css.walkRules(minimiseWhitespace);
        css.walkAtRules(minimiseWhitespace);

        // Remove final newline
        css.raws.after = '';
=======
            if (declaration.before) {
                declaration.before = declaration.before.replace(/[;\s]/g, '');
            }
            declaration.between = ':';
            declaration.semicolon = false;
        });

        css.eachRule(minimiseWhitespace);
        css.eachAtRule(minimiseWhitespace);

        // Remove final newline
        css.after = '';
>>>>>>> 14e45b6ab8a1ca954f5516d80087167e98f6b292
    };
});
