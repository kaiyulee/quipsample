'use strict';

var postcss = require('postcss');

module.exports = postcss.plugin('postcss-zindex', function () {
    return function (css) {
        var cache = require('./lib/layerCache')();
        var nodes = [];
        // First pass; cache all z indexes
<<<<<<< HEAD
        css.walkDecls('z-index', function (decl) {
=======
        css.eachDecl('z-index', function (decl) {
>>>>>>> 14e45b6ab8a1ca954f5516d80087167e98f6b292
            nodes.push(decl);
            cache.addValue(decl.value);
        });
        // Second pass; optimise
        nodes.forEach(function (decl) {
            // Need to coerce to string so that the
            // AST is updated correctly
            decl.value = '' + cache.convert(decl.value);
<<<<<<< HEAD
        });
=======
        })
>>>>>>> 14e45b6ab8a1ca954f5516d80087167e98f6b292
    };
});
